<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>Field AR Labeler</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
  <style>
    body,html{margin:0;padding:0;height:100%;background:#000}
    #c{width:100vw;height:100vh;display:block}
    .toolbar{position:fixed;bottom:0;left:0;right:0;background:rgba(0,0,0,0.7);padding:10px;text-align:center;z-index:999}
    button{margin:5px;padding:12px 16px;background:#fff;border:none;border-radius:8px;font-size:16px}
  </style>
</head>
<body>

<canvas id="c"></canvas>

<div class="toolbar">
  <input type="file" id="pick" accept="image/*" style="display:none">
  <button onclick="pick.click()">Choose Photo</button>
  <button onclick="addRect()">Rect</button>
  <button onclick="addCircle()">Circle</button>
  <button onclick="addText()">Text</button>
  <button onclick="exportJSON()">Export JSON</button>
  <button onclick="clearAll()">Clear</button>
</div>

<script>
const canvas = new fabric.Canvas('c', { backgroundColor: '#111' });
let bg = null;

// Load photo
document.getElementById('pick').onchange = e => {
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = ev => {
    fabric.Image.fromURL(ev.target.result, img => {
      canvas.setWidth(img.width);
      canvas.setHeight(img.height);
      canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas), {
        scaleX: canvas.width / img.width,
        scaleY: canvas.height / img.height
      });
      bg = img;
    });
  };
  reader.readAsDataURL(file);
};

// Tools
function addRect() {
  const rect = new fabric.Rect({ left: 100, top: 100, width: 150, height: 100, fill: 'rgba(255,0,0,0.5)', stroke: 'red', strokeWidth: 3 });
  canvas.add(rect);
}
function addCircle() {
  const circ = new fabric.Circle({ left: 200, top: 200, radius: 80, fill: 'rgba(0,255,0,0.5)', stroke: 'lime', strokeWidth: 4 });
  canvas.add(circ);
}
function addText() {
  const text = new fabric.Textbox('Tap to edit', { left: 150, top: 150, fontSize: 40, fill: '#ffff00', backgroundColor: 'rgba(0,0,0,0.5)' });
  canvas.add(text);
  canvas.setActiveObject(text);
  text.enterEditing();
}
function clearAll() { canvas.remove(...canvas.getObjects()); }
function exportJSON() {
  const data = { background: bg?.toDataURL(), objects: canvas.toJSON().objects };
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'fieldar-overlays.json'; a.click();
}

// Auto-open picker on start
setTimeout(() => document.getElementById('pick').click(), 600);
</script>
</body>
</html>